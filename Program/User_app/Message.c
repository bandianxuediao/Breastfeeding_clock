#include "includes.h"

MSG_QUEUE sys_msg_queue;//系统消息队列

//==================================================================================================
//| 函数名称 | PostMessage
//|----------|--------------------------------------------------------------------------------------
//| 函数功能 | 向消息队列中投递待处理消息
//|----------|--------------------------------------------------------------------------------------
//| 输入参数 | msg:待处理消息
//|----------|--------------------------------------------------------------------------------------       
//| 返回参数 | 1 添加成功
//|          | 0 如果消息队列中待处理消息已满，添加失败
//|----------|--------------------------------------------------------------------------------------       
//| 函数设计 | 编写人：李亚东    时间：2016-08-25 
//|----------|-------------------------------------------------------------------------------------- 
//|   备注   | 无
//|----------|-------------------------------------------------------------------------------------- 
//| 修改记录 | 修改人：          时间：         修改内容： 
//==================================================================================================
u8 PostMessage(MSG msg)
{
    if((sys_msg_queue.start + MSG_QUEUE_SIZE) != sys_msg_queue.end)	
	{//查看队列是否已经存满，消息队列中只能存放MSG_QUEUE_SIZE个事件
        sys_msg_queue.msg[sys_msg_queue.end &(MSG_QUEUE_SIZE-1)] = msg ;
		sys_msg_queue.end++ ;
		return 1;
	}
	return 0;
}

//==================================================================================================
//| 函数名称 | PeekMessage 
//|----------|--------------------------------------------------------------------------------------
//| 函数功能 | 从消息队列中获取消息(非阻塞) 
//|----------|--------------------------------------------------------------------------------------
//| 输入参数 | 无
//|----------|--------------------------------------------------------------------------------------       
//| 返回参数 | 待处理消息
//|----------|--------------------------------------------------------------------------------------       
//| 函数设计 | 编写人：李亚东    时间：2016-08-25  
//|----------|-------------------------------------------------------------------------------------- 
//|   备注   | 消息队列中没有待处理消息时返回一个特殊消息。
//|----------|-------------------------------------------------------------------------------------- 
//| 修改记录 | 修改人：          时间：         修改内容： 
//==================================================================================================
MSG PeekMessage(void)
{
    MSG msg;
	
	//判断消息队列中是否有待处理消息
	if(sys_msg_queue.start == sys_msg_queue.end)
	{//消息队列中没有待处理消息，返回一个特殊消息
		msg.code = NULL_CODE;
		msg.param1 = 0;
		msg.param2 = 0;
	}
	else
	{
		msg = sys_msg_queue.msg[sys_msg_queue.start & (MSG_QUEUE_SIZE-1)] ;
		sys_msg_queue.start++ ;
	}
	return msg ;	
}

//==================================================================================================
//| 函数名称 | RemoveAllMessage 
//|----------|--------------------------------------------------------------------------------------
//| 函数功能 | 删除消息队列中的所有消息
//|----------|--------------------------------------------------------------------------------------
//| 输入参数 | 无
//|----------|--------------------------------------------------------------------------------------       
//| 返回参数 | 无
//|----------|--------------------------------------------------------------------------------------       
//| 函数设计 | 编写人：李亚东    时间：2016-08-25 
//|----------|-------------------------------------------------------------------------------------- 
//|   备注   | 
//|----------|-------------------------------------------------------------------------------------- 
//| 修改记录 | 修改人：          时间：         修改内容： 
//==================================================================================================
void RemoveAllMessage(void)
{
	sys_msg_queue.end = 0;
	sys_msg_queue.start = sys_msg_queue.end;
}

